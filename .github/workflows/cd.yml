name: Deploy to Render

on:
  push:
    branches: [ main, master, homework2 ]
  workflow_run:
    workflows: ["CI Test Runner"]
    types:
      - completed

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'push' || (github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.head_branch == 'main') }}
    steps:
      - name: Deploy to Render
        # Only run if I have the secrets configured, otherwise this step is a placeholder
        # Using a simple curl request to the Render Deploy Hook which is the standard way for "Deploy Hooks"
        if: env.RENDER_DEPLOY_HOOK_URL != ''
        run: curl -X POST ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
        env:
          RENDER_DEPLOY_HOOK_URL: ${{ secrets.RENDER_DEPLOY_HOOK_URL }}
